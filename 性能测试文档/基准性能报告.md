
# **基准性能测试报告**

## **1. 报告概述**

### 1.1 测试背景与目标

* **•背景**：本次基准性能测试针对【系统名称】（如：电商交易系统V2.0 / 银行核心账务系统），旨在建立系统在标准环境下的 **性能基线数据**（如响应时间、吞吐量、资源利用率等），为后续迭代优化、容量规划及生产环境性能验证提供参考依据。
* **•目标**：* **•**明确系统在** 典型业务场景** 下的核心性能指标（如单接口响应时间、系统最大并发处理能力）；
  * **•**评估当前系统架构（如数据库、缓存、中间件配置）的基础性能表现；
  * **•**为后续负载测试、压力测试设定合理的初始阈值（如“稳态TPS应≥基准值的80%”）。

### 1.2 测试范围

* **•覆盖场景**：选取系统中最核心、高频的业务功能（如用户登录、商品查询、订单提交），具体包括：* **•**场景1：用户登录（验证基础认证性能）；
  * **•**场景2：商品列表查询（高频读接口）；
  * **•**场景3：订单创建（核心写接口，含数据库事务）。
* **•排除场景**：非核心功能（如日志导出、批量数据同步）或依赖外部系统（如第三方支付回调）的接口暂不纳入本次基准测试。

### 1.3 测试环境

| 环境类型               | 配置详情（关键参数）                                                                                                                                                                                                            | 与生产环境差异说明                                                                          |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------- |
| **测试环境**     | - 服务器：应用服务器（4核8G×2节点，Docker+K8s），数据库（MySQL 8.0，8核16G主库+4核8G从库）；``- 中间件：Redis 6.2（单节点，8核16G），Nginx（2核4G）；``- 网络：内网带宽1Gbps，客户端与服务器同机房（延迟<1ms）。 | 生产环境应用服务器为10节点（4核16G），数据库为主从+读写分离（3节点集群），Redis为集群模式。 |
| **生产环境参考** | （可选）生产环境当前日均PV 100万，峰值TPS约2000（历史监控数据）。                                                                                                                                                               | 本次基准测试环境为简化版，结果仅反映当前配置下的基础性能。                                  |

## **2. 测试方法与工具**

### 2.1 测试策略

采用 **“单接口逐步加压+混合场景验证”** 策略：

1. **1.单接口基准测试**：针对每个核心业务接口，固定并发用户数（如10/50/100/200），逐步增加压力，记录响应时间、吞吐量（TPS/QPS）及资源利用率，直至出现性能拐点（如响应时间陡增或错误率上升）。
2. **2.混合场景测试**（可选）：模拟用户真实行为比例（如登录:查询:下单=3:5:2），以固定并发数运行，验证多接口并发时的整体性能表现。

### 2.2 测试工具与参数

* **•压测工具**：JMeter 5.6（模拟HTTP请求）、Locust（可选，用于复杂用户行为建模）。
* **•监控工具**：* **•**服务器资源：Prometheus+Grafana（采集CPU/内存/磁盘I/O/网络带宽）、Arthas（Java应用方法级性能分析）；
  * **•**数据库：MySQL慢查询日志（阈值>100ms）、Performance Schema（监控连接数、锁等待）；
  * **•**中间件：Redis监控（命中率、命令延迟）、Nginx访问日志（请求分发耗时）。
* **•关键参数**：* **•**思考时间（Think Time）：模拟用户操作间隔（如登录后停留2-3秒再查询），设置为随机值（1-3秒）；
  * **•**超时设置：HTTP请求超时时间为10秒（避免因服务端无响应导致压测工具阻塞）；
  * **•**数据准备：测试前通过脚本预埋基础数据（如10万条商品记录、1万注册用户），避免因数据量过小导致缓存命中率失真。

## **3. 核心性能指标结果**

### 3.1 业务级性能指标（用户视角）

| 测试场景     | 并发用户数 | 平均响应时间（RT） | P95响应时间 | 吞吐量（TPS/QPS） | 成功率 | 错误类型（如有）             |
| ------------ | ---------- | ------------------ | ----------- | ----------------- | ------ | ---------------------------- |
| 用户登录     | 10         | 320ms              | 450ms       | 31 TPS            | 100%   | 无                           |
|              | 50         | 680ms              | 920ms       | 73 TPS            | 100%   | 无                           |
|              | 100        | 1.2s               | 1.8s        | 82 TPS            | 99.8%  | 1%超时（HTTP 504）           |
|              | 200        | 2.5s               | 3.2s        | 85 TPS            | 98.5%  | 10%超时，5%数据库连接超时    |
| 商品列表查询 | 10         | 180ms              | 250ms       | 55 QPS            | 100%   | 无                           |
|              | 50         | 220ms              | 350ms       | 227 QPS           | 100%   | 无                           |
|              | 100        | 380ms              | 600ms       | 263 QPS           | 100%   | 无                           |
|              | 200        | 850ms              | 1.2s        | 235 QPS           | 99.2%  | 2%缓存未命中（Redis延迟高）  |
| 订单创建     | 10         | 650ms              | 900ms       | 15 TPS            | 100%   | 无                           |
|              | 30         | 1.1s               | 1.5s        | 27 TPS            | 100%   | 无                           |
|              | 50         | 2.1s               | 2.8s        | 18 TPS            | 98.7%  | 5%库存扣减失败（数据库死锁） |
|              | 80         | 3.5s               | 4.2s        | 22 TPS            | 95.1%  | 15%数据库事务超时            |

### 3.2 系统资源指标（服务器视角）

| 指标项                   | 场景（峰值并发）    | 平均值              | 峰值   | 阈值（成功标准）  | 是否达标         |
| ------------------------ | ------------------- | ------------------- | ------ | ----------------- | ---------------- |
| **应用服务器CPU**  | 订单创建（80并发）  | 65%                 | 82%    | ≤70%（稳态）     | 否（峰值超阈值） |
| **应用服务器内存** | 所有场景            | 55%                 | 68%    | ≤80%             | 是               |
| **数据库CPU**      | 订单创建（80并发）  | 78%                 | 91%    | ≤70%             | 否（持续超阈值） |
| **数据库连接数**   | 订单创建（80并发）  | 85/100（活跃/最大） | 95/100 | ≤80%（活跃占比） | 否（接近上限）   |
| **Redis内存**      | 商品查询（200并发） | 45%                 | 52%    | ≤80%             | 是               |
| **Redis命中率**    | 商品查询（200并发） | 92%                 | 88%    | ≥95%             | 否（下降明显）   |

### 3.3 中间件/数据库专项指标

| 指标项                  | 场景（峰值并发）    | 结果                          | 阈值/说明                  | 是否达标                        |
| ----------------------- | ------------------- | ----------------------------- | -------------------------- | ------------------------------- |
| **MySQL QPS**     | 订单创建（80并发）  | 120 QPS                       | 目标≥200 QPS（基准需求）  | 否                              |
| **MySQL慢查询**   | 订单创建（80并发）  | 15条（>100ms）                | 目标≤5条                  | 否                              |
| **Redis命令延迟** | 商品查询（200并发） | 平均5ms（GET）、20ms（KEYS*） | 目标≤10ms（所有命令）     | 部分命令超阈值（KEYS*扫描导致） |
| **Nginx吞吐量**   | 所有场景            | 500 QPS                       | 目标≥1000 QPS（生产预估） | 否                              |

## **4. 关键结论与问题分析**

### 4.1 基准性能基线总结

* **•系统最佳表现场景**：商品列表查询在低并发（≤100用户）时性能最优（平均RT≤400ms，TPS≥260），主要依赖Redis缓存命中（命中率>90%）。
* **•核心瓶颈场景**：订单创建（写接口）在高并发（≥50用户）时性能下降显著（RT从1.1s增至2.8s，TPS从27降至18），主要受限于数据库事务锁竞争和连接池不足。
* **•资源瓶颈**：数据库CPU和连接数在并发超过50时持续超阈值（CPU>70%，连接数接近100%），成为系统整体吞吐量的限制因素。

### 4.2 主要问题与根因

1. **1.订单创建接口性能差**：

   * **•**问题：并发50+时RT陡增（2.1s），成功率下降（98.7%→95.1%），错误类型为库存扣减失败/事务超时。
   * **•**根因：数据库事务未优化（如未使用乐观锁导致死锁）、连接池最大连接数配置过低（当前100，实际需求≥150）、订单表未对“用户ID+商品ID”复合索引优化（导致锁范围过大）。
2. **2.数据库资源不足**：

   * **•**问题：MySQL CPU峰值达91%，QPS仅120（目标200），慢查询15条。
   * **•**根因：未启用读写分离（所有查询打在主库）、部分复杂查询未加索引（如订单列表的“创建时间范围查询”全表扫描）。
3. **3.缓存效率下降**：

   * **•**问题：商品查询高并发（200用户）时Redis命中率降至88%（目标≥95%），KEYS*命令导致延迟升高（20ms）。
   * **•**根因：代码中误用KEYS *模糊查询（应改为SCAN），且热点商品缓存未设置合理的过期策略（部分Key被频繁淘汰）。

## **5. 优化建议**

### 5.1 短期快速优化（1-2周）

* **•数据库层**：* **•**调整连接池配置（最大连接数从100→150），优化订单表索引（添加“用户ID+商品ID”联合索引）；
  * **•**将慢查询（如全表扫描的“创建时间范围查询”）添加复合索引（如 `idx_create_time_user`）。
* **•应用层**：* **•**修复订单创建接口的库存扣减逻辑（改用乐观锁替代悲观锁，避免死锁）；
  * **•**替换代码中的KEYS *命令为SCAN（避免阻塞Redis）。
* **•缓存层**：* **•**热点商品缓存设置永不过期+后台异步更新策略，避免缓存击穿；
  * **•**扩容Redis实例内存（当前8核16G→16核32G），提升并发处理能力。

### 5.2 长期优化（1-3个月）

* **•架构层**：* **•**引入数据库读写分离（主库写，从库读），将订单查询等读操作分流到从库；
  * **•**对订单服务进行微服务拆分（独立部署订单核心模块），避免与其他低频服务共享资源。
* **•容量规划**：* **•**基于本次基准数据，生产环境应用服务器至少扩容至8节点（原4节点），数据库主库升级为16核32G；
  * **•**压测环境配置向生产环境对齐（如Redis集群化、Nginx负载均衡优化）。

## **6. 附录**

* **•附件1**：详细测试数据（CSV格式，包含各并发数下的RT/TPS/错误率原始记录）；
* **•附件2**：监控截图（CPU/内存/数据库连接数随时间变化的曲线图）；
* **•附件3**：压测脚本（JMeter计划文件，含请求参数、思考时间配置）；
* **•术语解释**：TPS（每秒事务数）、P95（95%请求的响应时间不超过该值）、QPS（每秒查询数）。

**报告生成时间**：202X年XX月XX日
**测试负责人**：XXX（联系方式：xxx@xx.com）
**评审人**：开发负责人XXX、运维负责人XXX（确认：□是 □否）
