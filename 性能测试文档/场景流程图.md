# **性能测试场景流程图（核心业务流程示例）**

场景流程图是性能测试中用于描述 **具体业务场景的操作步骤、系统组件交互顺序及数据流向** 的图表，帮助团队明确测试场景的细节逻辑（如用户行为路径、接口调用关系），确保压测脚本与真实用户操作一致。以下为常见业务场景的流程图设计说明及示例（以电商系统的“用户登录→商品查询→订单创建”核心流程为例）。

## **一、流程图设计原则**

1. **1.清晰表达用户行为**：按真实用户操作顺序绘制（如先登录→再浏览商品→最后下单），标注每个步骤的输入/输出（如“输入用户名密码”“返回商品列表JSON”）。
2. **2.明确系统组件交互**：展示请求经过的各个系统模块（如前端→网关→后端服务→数据库/缓存），以及组件间的协议（如HTTP/HTTPS、gRPC、RPC）。
3. **3.标注关键参数**：包括请求参数（如用户ID、商品ID）、依赖数据（如登录后获取的Token）、缓存/数据库交互（如“查询Redis缓存→未命中则查MySQL”）。
4. **4.区分正常与异常分支**（可选）：若需验证异常场景（如登录失败、库存不足），可补充错误处理路径（如“密码错误→返回401→终止流程”）。

## **二、典型场景流程图示例**

### **示例1：电商核心流程（登录→查询商品→创建订单）**

**适用场景**：验证用户从登录到下单的全链路性能（覆盖认证、读接口、写接口及事务处理）。

#### **流程步骤说明**

1. **1.用户登录**

   * **•**操作：用户输入用户名/密码，前端调用 `/api/login`接口（POST请求）。
   * **•**系统交互：请求经Nginx负载均衡→网关（鉴权校验）→用户服务（验证账号密码）→数据库（查询用户信息）。
   * **•**关键动作：成功后返回JWT Token（用于后续接口鉴权），失败返回401错误。
2. **2.商品列表查询**

   * **•**操作：用户登录后，前端携带Token调用 `/api/products`接口（GET请求，带分页参数）。
   * **•**系统交互：请求经网关→商品服务→优先查询Redis缓存（Key为“hot_products:{页码}”），若缓存未命中则查询MySQL商品表（带索引优化）→将结果写入Redis（设置过期时间）。
   * **•**关键动作：返回商品列表JSON（含ID、名称、价格），缓存命中率影响响应时间。
3. **3.订单创建**

   * **•**操作：用户选择商品后，前端调用 `/api/order/create`接口（POST请求，传用户ID、商品ID列表、数量）。
   * **•**系统交互：请求经网关→订单服务→开启数据库事务→检查库存（查询MySQL库存表）→扣减库存（UPDATE语句）→生成订单记录（INSERT订单表）→提交事务→返回订单ID。
   * **•**关键动作：若库存不足或事务冲突（如并发扣减同一商品），返回400/500错误。

#### **流程图（文字描述版，可用Draw.io/Lucidchart绘制）**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="expand-code-width-placeholder"></div><div class="hyc-common-markdown__code__hd"><div class="hyc-common-markdown__code__hd__inner"><div class="hyc-common-markdown__code__hd__l">plaintext</div><div class="hyc-common-markdown__code__hd__r"><div class="hyc-common-markdown__code__option"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.18563 1.02148H6.27219C7.2371 1.02147 8.02186 1.02145 8.64056 1.10464C9.28576 1.19138 9.83952 1.37836 10.2808 1.81962C10.722 2.26088 10.909 2.81464 10.9958 3.45984C11.013 3.58781 11.0266 3.72289 11.0374 3.8652C11.4689 3.87473 11.8501 3.8954 12.1831 3.94018C12.8283 4.02693 13.3821 4.21391 13.8234 4.65517C14.2646 5.09643 14.4516 5.65018 14.5383 6.29538C14.6215 6.9141 14.6215 7.69882 14.6215 8.66375V10.167C14.6215 11.1319 14.6215 11.9166 14.5383 12.5354C14.4516 13.1806 14.2646 13.7343 13.8234 14.1756C13.3821 14.6168 12.8283 14.8038 12.1831 14.8906C11.5644 14.9737 10.7797 14.9737 9.81476 14.9737H9.72821C8.76328 14.9737 7.97855 14.9737 7.35983 14.8906C6.71463 14.8038 6.16088 14.6168 5.71962 14.1756C5.27836 13.7343 5.09138 13.1806 5.00464 12.5354C4.98743 12.4074 4.97379 12.2723 4.96296 12.13C4.53148 12.1205 4.15032 12.0998 3.81726 12.055C3.17206 11.9683 2.6183 11.7813 2.17704 11.34C1.73578 10.8988 1.5488 10.345 1.46206 9.69981C1.37888 9.0811 1.37889 8.29639 1.37891 7.33148V5.82821C1.37889 4.8633 1.37888 4.07854 1.46206 3.45984C1.5488 2.81464 1.73578 2.26088 2.17704 1.81962C2.6183 1.37836 3.17206 1.19138 3.81726 1.10464C4.43596 1.02145 5.22072 1.02147 6.18563 1.02148ZM4.92325 10.9287C4.92148 10.6885 4.92148 10.4347 4.92148 10.167V8.66375C4.92147 7.69882 4.92145 6.9141 5.00464 6.29538C5.09138 5.65018 5.27836 5.09643 5.71962 4.65517C6.16088 4.21391 6.71463 4.02693 7.35983 3.94018C7.97855 3.857 8.76327 3.85701 9.7282 3.85703H9.81477C9.82079 3.85703 9.82681 3.85703 9.83282 3.85703C9.82532 3.77412 9.8166 3.69516 9.80646 3.61973C9.73761 3.1076 9.61339 2.84929 9.43225 2.66815C9.25111 2.48701 8.9928 2.36279 8.48066 2.29394C7.95127 2.22276 7.24761 2.22149 6.22891 2.22149C5.21021 2.22149 4.50655 2.22276 3.97716 2.29394C3.46502 2.36279 3.20671 2.48701 3.02557 2.66815C2.84443 2.84929 2.72021 3.1076 2.65136 3.61973C2.58018 4.14913 2.57891 4.85279 2.57891 5.87149V7.28816C2.57891 8.30685 2.58018 9.01052 2.65136 9.53991C2.72021 10.052 2.84443 10.3104 3.02557 10.4915C3.20671 10.6726 3.46502 10.7969 3.97716 10.8657C4.24274 10.9014 4.55218 10.9195 4.92325 10.9287ZM6.19393 6.45528C6.26279 5.94314 6.38701 5.68483 6.56815 5.5037C6.74928 5.32256 7.0076 5.19834 7.51973 5.12948C8.04913 5.05831 8.75279 5.05703 9.77149 5.05703C10.7902 5.05703 11.4938 5.05831 12.0232 5.12948C12.5354 5.19834 12.7937 5.32256 12.9748 5.50369C13.156 5.68483 13.2802 5.94314 13.349 6.45528C13.4202 6.98467 13.4215 7.68834 13.4215 8.70703V10.1237C13.4215 11.1424 13.4202 11.8461 13.349 12.3755C13.2802 12.8876 13.156 13.1459 12.9748 13.327C12.7937 13.5082 12.5354 13.6324 12.0232 13.7013C11.4938 13.7724 10.7902 13.7737 9.77149 13.7737C8.75279 13.7737 8.04913 13.7724 7.51973 13.7013C7.0076 13.6324 6.74929 13.5082 6.56815 13.327C6.38701 13.1459 6.26279 12.8876 6.19393 12.3755C6.12276 11.8461 6.12149 11.1424 6.12149 10.1237V8.70704C6.12149 7.68834 6.12276 6.98467 6.19393 6.45528Z" fill="currentColor"></path></svg><span class="hyc-common-markdown__code__option__text">复制</span></div><div class="hyc-common-markdown__code__line"></div><div class="hyc-common-markdown__code__expand "><span class="yb-icon iconfont-yb icon-yb-ic_expand_16"></span></div></div></div></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-plaintext">[用户]  
  ↓ (输入账号密码)  
[前端：调用/login接口]  
  ↓ (HTTP POST)  
[Nginx LB → 网关 → 用户服务]  
  ↓ (验证账号密码，查MySQL用户表)  
[返回Token（成功） or 401（失败）]  
  ↓ (成功则携带Token继续)  
[前端：调用/products接口]  
  ↓ (HTTP GET，带Token鉴权)  
[网关 → 商品服务 → Redis缓存]  
  ├─ 缓存命中 → 直接返回商品列表（低延迟）  
  └─ 缓存未命中 → 查询MySQL商品表 → 写入Redis → 返回列表  
  ↓ (获取商品列表后)  
[前端：调用/order/create接口]  
  ↓ (HTTP POST，传商品ID/数量)  
[网关 → 订单服务 → 数据库事务]  
  ↓ (检查库存 → 扣减库存 → 生成订单)  
[返回订单ID（成功） or 错误（库存不足/事务冲突）]  </code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

### **示例2：用户登录（单一接口深度验证）**

**适用场景**：聚焦认证模块的性能（如高并发登录时的Token生成、数据库查询压力）。

#### **流程步骤说明**

1. **1.**用户输入用户名/密码，前端调用 `/api/login`接口（POST请求，参数：username, password）。
2. **2.**请求经Nginx负载均衡→API网关（校验请求格式）→用户服务（业务逻辑层）。
3. **3.**用户服务执行以下操作：* **•**查询MySQL用户表（`SELECT * FROM users WHERE username=?`），验证密码是否匹配（如BCrypt加密比对）。
   * **•**若验证成功，生成JWT Token（包含用户ID、过期时间），并将Token存入Redis（Key为 `token:{用户ID}`，用于后续接口快速鉴权）。
   * **•**若验证失败（用户名不存在/密码错误），返回401状态码。
4. **4.**返回响应：成功时返回Token及用户基础信息（如昵称），失败时返回错误码及提示。

#### **流程图（简化版）**

<pre class="ybc-pre-component ybc-pre-component_not-math"><div class="hyc-common-markdown__code"><div class="expand-code-width-placeholder"></div><div class="hyc-common-markdown__code__hd"><div class="hyc-common-markdown__code__hd__inner"><div class="hyc-common-markdown__code__hd__l">plaintext</div><div class="hyc-common-markdown__code__hd__r"><div class="hyc-common-markdown__code__option"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.18563 1.02148H6.27219C7.2371 1.02147 8.02186 1.02145 8.64056 1.10464C9.28576 1.19138 9.83952 1.37836 10.2808 1.81962C10.722 2.26088 10.909 2.81464 10.9958 3.45984C11.013 3.58781 11.0266 3.72289 11.0374 3.8652C11.4689 3.87473 11.8501 3.8954 12.1831 3.94018C12.8283 4.02693 13.3821 4.21391 13.8234 4.65517C14.2646 5.09643 14.4516 5.65018 14.5383 6.29538C14.6215 6.9141 14.6215 7.69882 14.6215 8.66375V10.167C14.6215 11.1319 14.6215 11.9166 14.5383 12.5354C14.4516 13.1806 14.2646 13.7343 13.8234 14.1756C13.3821 14.6168 12.8283 14.8038 12.1831 14.8906C11.5644 14.9737 10.7797 14.9737 9.81476 14.9737H9.72821C8.76328 14.9737 7.97855 14.9737 7.35983 14.8906C6.71463 14.8038 6.16088 14.6168 5.71962 14.1756C5.27836 13.7343 5.09138 13.1806 5.00464 12.5354C4.98743 12.4074 4.97379 12.2723 4.96296 12.13C4.53148 12.1205 4.15032 12.0998 3.81726 12.055C3.17206 11.9683 2.6183 11.7813 2.17704 11.34C1.73578 10.8988 1.5488 10.345 1.46206 9.69981C1.37888 9.0811 1.37889 8.29639 1.37891 7.33148V5.82821C1.37889 4.8633 1.37888 4.07854 1.46206 3.45984C1.5488 2.81464 1.73578 2.26088 2.17704 1.81962C2.6183 1.37836 3.17206 1.19138 3.81726 1.10464C4.43596 1.02145 5.22072 1.02147 6.18563 1.02148ZM4.92325 10.9287C4.92148 10.6885 4.92148 10.4347 4.92148 10.167V8.66375C4.92147 7.69882 4.92145 6.9141 5.00464 6.29538C5.09138 5.65018 5.27836 5.09643 5.71962 4.65517C6.16088 4.21391 6.71463 4.02693 7.35983 3.94018C7.97855 3.857 8.76327 3.85701 9.7282 3.85703H9.81477C9.82079 3.85703 9.82681 3.85703 9.83282 3.85703C9.82532 3.77412 9.8166 3.69516 9.80646 3.61973C9.73761 3.1076 9.61339 2.84929 9.43225 2.66815C9.25111 2.48701 8.9928 2.36279 8.48066 2.29394C7.95127 2.22276 7.24761 2.22149 6.22891 2.22149C5.21021 2.22149 4.50655 2.22276 3.97716 2.29394C3.46502 2.36279 3.20671 2.48701 3.02557 2.66815C2.84443 2.84929 2.72021 3.1076 2.65136 3.61973C2.58018 4.14913 2.57891 4.85279 2.57891 5.87149V7.28816C2.57891 8.30685 2.58018 9.01052 2.65136 9.53991C2.72021 10.052 2.84443 10.3104 3.02557 10.4915C3.20671 10.6726 3.46502 10.7969 3.97716 10.8657C4.24274 10.9014 4.55218 10.9195 4.92325 10.9287ZM6.19393 6.45528C6.26279 5.94314 6.38701 5.68483 6.56815 5.5037C6.74928 5.32256 7.0076 5.19834 7.51973 5.12948C8.04913 5.05831 8.75279 5.05703 9.77149 5.05703C10.7902 5.05703 11.4938 5.05831 12.0232 5.12948C12.5354 5.19834 12.7937 5.32256 12.9748 5.50369C13.156 5.68483 13.2802 5.94314 13.349 6.45528C13.4202 6.98467 13.4215 7.68834 13.4215 8.70703V10.1237C13.4215 11.1424 13.4202 11.8461 13.349 12.3755C13.2802 12.8876 13.156 13.1459 12.9748 13.327C12.7937 13.5082 12.5354 13.6324 12.0232 13.7013C11.4938 13.7724 10.7902 13.7737 9.77149 13.7737C8.75279 13.7737 8.04913 13.7724 7.51973 13.7013C7.0076 13.6324 6.74929 13.5082 6.56815 13.327C6.38701 13.1459 6.26279 12.8876 6.19393 12.3755C6.12276 11.8461 6.12149 11.1424 6.12149 10.1237V8.70704C6.12149 7.68834 6.12276 6.98467 6.19393 6.45528Z" fill="currentColor"></path></svg><span class="hyc-common-markdown__code__option__text">复制</span></div><div class="hyc-common-markdown__code__line"></div><div class="hyc-common-markdown__code__expand "><span class="yb-icon iconfont-yb icon-yb-ic_expand_16"></span></div></div></div></div><pre class="hyc-common-markdown__code-lan"><div class="hyc-code-scrollbar"><div class="hyc-code-scrollbar__view"><code class="language-plaintext">[用户] → [前端：/login接口] → [Nginx LB] → [网关] → [用户服务]  
  ↓  
[查询MySQL用户表] → [密码比对] → [成功？]  
  ├─ 是 → 生成Token → 写入Redis → 返回Token（200 OK）  
  └─ 否 → 返回401（密码错误/用户不存在）  </code></div><div class="hyc-code-scrollbar__track"><div class="hyc-code-scrollbar__thumb"></div></div><div><div></div></div></div></pre></div></pre>

## **三、流程图绘制工具与输出**

### 1. **常用工具推荐**

* **•专业工具**：Draw.io（免费，支持云存储）、Lucidchart（协作友好）、Microsoft Visio（企业级）。
* **•开发者工具**：PlantUML（代码生成流程图，适合嵌入文档）、StarUML（UML扩展，支持时序图补充）。
* **•在线协作**：ProcessOn（国内免费额度高）、Figma（设计团队常用）。

### 2. **输出要求**

* **•测试脚本关联**：流程图中的每个接口（如 `/login`、`/order/create`）需与压测脚本中的请求一一对应（确保参数、Header、鉴权逻辑一致）。
* **•标注性能关键点**：在流程图中用颜色/图标标记潜在瓶颈（如红色标注“数据库查询”“事务处理”），辅助测试重点分析。
* **•版本控制**：流程图与测试用例、压测脚本同步管理（如Git仓库中存放 `.drawio`文件或PNG+说明文档）。

## **四、流程图在性能测试中的作用**

1. **1.指导脚本开发**：明确压测工具（如JMeter）中需要模拟的请求顺序、参数传递（如登录后提取Token用于后续接口）、思考时间（如用户浏览商品间隔）。
2. **2.定位性能瓶颈**：当响应时间超标时，通过流程图快速定位是前端交互、网关转发、后端服务逻辑，还是数据库/缓存查询导致的延迟。
3. **3.沟通协作**：向开发、运维团队直观展示测试场景的业务逻辑，避免因理解偏差导致“测试结果无效”（例如：测试时未携带Token导致接口返回401，误判为服务性能问题）。

**附：流程图符号说明（通用）**

* **•**矩形：操作步骤（如“调用接口”“查询数据库”）；
* **•**菱形：判断分支（如“登录成功？→ 是/否”）；
* **•**圆角矩形：开始/结束节点（如“用户发起请求”“返回结果”）；
* **•**箭头：数据流向或步骤顺序；
* **•**云朵：外部系统（如Nginx、Redis、MySQL）；
* **•**数据库图标：数据存储交互（如查询/写入表）。

通过结合场景流程图与性能指标矩阵表（见前一文档），团队可以系统化设计压测方案，精准验证系统性能并快速定位优化点。
